package com.mercurio.lms.carregamento.swt.action;

import java.io.Serializable;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import com.mercurio.adsm.framework.model.CrudAction;
import com.mercurio.adsm.framework.model.ResultSetPage;
import com.mercurio.lms.carregamento.model.PrestadorServico;
import com.mercurio.lms.carregamento.model.service.PrestadorServicoService;
import com.mercurio.lms.configuracoes.model.Pessoa;
import com.mercurio.lms.util.FormatUtils;
import com.mercurio.lms.util.PessoaUtils;

/**
 * Generated by: ADSM ActionGenerator
 *  
 * Não inserir documentação após ou remover a tag do XDoclet a seguir.
 * O valor do <code>id</code> informado abaixo deve ser utilizado para referenciar este serviço.
 * @spring.bean id="lms.carregamento.swt.manterPrestadoresServicoAction"
 */

public class ManterPrestadoresServicoAction extends CrudAction {

	public void setPrestadorServico(PrestadorServicoService prestadorServicoService) {
		this.defaultService = prestadorServicoService;
	}
	public PrestadorServicoService getPrestadorServicoService() {
		return (PrestadorServicoService)defaultService;
	}

	
	public void removeById(java.lang.Long id) {
		getPrestadorServicoService().removePrestadorServicoById(id);
    }

	/**
	 * @@ParametrizedAttribute("java.lang.Long")
	 */
    public void removeByIds(List ids) {
    	getPrestadorServicoService().removePrestadorServicoByIds(ids);
    }

    public PrestadorServico findById(java.lang.Long id) {
    	return getPrestadorServicoService().findById(id);
    }

    /**
	 * Verifica se já existe um Prestador de Serviço com o Número e Tipo de Identificação informado.
	 * @param map deve conter o numero e tipo de identificação; 
	 */
	public Map validateExistenciaPrestadorServico(Map criteria){
		Map map = new HashMap();
		Pessoa pessoa = getPrestadorServicoService().validatePrestadorServico(criteria);
		if (pessoa!=null){
			map.put("tpIdentificacao", pessoa.getTpIdentificacao().getValue());
			map.put("nrIdentificacao", FormatUtils.formatIdentificacao(pessoa));
			map.put("idPessoa", pessoa.getIdPessoa());
			map.put("nmPessoa", pessoa.getNmPessoa());
			map.put("dsEmail", pessoa.getDsEmail());
		}
		return map;
	}
	
	public Pessoa validateIdentificacao(Map map) {
		return getPrestadorServicoService().validateIdentificacao(map);
	}

    public Serializable store(PrestadorServico bean) {
        return getPrestadorServicoService().store(bean);
    }


	public Integer getRowCount(Map criteria) {
		return getPrestadorServicoService().getRowCount(populateParametros(criteria));
	}


	public ResultSetPage findPaginated(Map criteria) {
		ResultSetPage rsp = getPrestadorServicoService().findPaginated(populateParametros(criteria));
		List lista = new ArrayList();
		for (Iterator iter = rsp.getList().iterator(); iter.hasNext();) {
			PrestadorServico ps = (PrestadorServico)iter.next();
			Map map = new HashMap();
			map.put("idPrestadorServico", ps.getIdPrestadorServico());
			map.put("tpIdentificacao", ps.getPessoa().getTpIdentificacao());
			map.put("nrIdentificacaoFormatado", FormatUtils.formatIdentificacao(ps.getPessoa()) );
			map.put("nmPessoa", ps.getPessoa().getNmPessoa());
			map.put("tpSituacao", ps.getTpSituacao());
			lista.add(map);
		}
		rsp.setList(lista);
		return rsp;
	}
	
	private Map populateParametros(Map criteria) {
		Map mapPessoa = new HashMap();
		mapPessoa.put("nrIdentificacao", PessoaUtils.clearIdentificacao((String)criteria.get("nrIdentificacao")));
		mapPessoa.put("tpIdentificacao", criteria.get("tpIdentificacao"));
		mapPessoa.put("nmPessoa", criteria.get("nmPessoa"));
		mapPessoa.put("tpPessoa", criteria.get("tpPessoa"));

		Map map = new HashMap();
		map.put("pessoa", mapPessoa);
		map.put("tpSituacao", criteria.get("tpSituacao"));
		map.put("_currentPage", criteria.get("_currentPage"));
		map.put("_currentPage", criteria.get("_currentPage"));
		map.put("_pageSize", criteria.get("_pageSize"));
		map.put("_order", criteria.get("_order"));
		map.put("tpSituacao", criteria.get("tpSituacao"));
		return map;
	}
}