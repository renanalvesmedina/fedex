package com.mercurio.lms.entrega.action;

import java.util.List;
import java.util.Map;

import com.mercurio.adsm.framework.model.CrudAction;
import com.mercurio.adsm.framework.model.ResultSetPage;
import com.mercurio.adsm.framework.util.TypedFlatMap;
import com.mercurio.lms.entrega.model.Turno;
import com.mercurio.lms.entrega.model.service.TurnoService;
import com.mercurio.lms.municipios.model.Filial;
import com.mercurio.lms.municipios.model.service.FilialService;
import com.mercurio.lms.util.JTVigenciaUtils;
import com.mercurio.lms.util.session.SessionUtils;

import com.mercurio.adsm.framework.annotations.ParametrizedAttribute;

/**
 * Generated by: ADSM ActionGenerator
 *  
 * Não inserir documentação após ou remover a tag do XDoclet a seguir.
 * O valor do <code>id</code> informado abaixo deve ser utilizado para referenciar este serviço.
 * @spring.bean id="lms.entrega.manterTurnosAgendamentoAction"
 */

public class ManterTurnosAgendamentoAction extends CrudAction {
	
	private FilialService filialService;
	private TurnoService turnoService;
	
    //  metodo responsável por trazer informações do usuario logado
    public Map findInformacoesUsuarioLogado(Map criteria){
        TypedFlatMap typedFlatMap = new TypedFlatMap();
        
        typedFlatMap.put("filial.idFilial", SessionUtils.getFilialSessao().getIdFilial());
        typedFlatMap.put("filial.sgFilial", SessionUtils.getFilialSessao().getSgFilial());
        typedFlatMap.put("pessoa.nmFantasia",SessionUtils.getFilialSessao().getPessoa().getNmFantasia());        
        
        return typedFlatMap;
        
    }
    
    public TypedFlatMap storeCustom(TypedFlatMap map) {
    	Turno turno = new Turno();
    	if (map.getLong("idTurno") != null){
    		turno.setIdTurno(map.getLong("idTurno"));
    	}

    	Filial filial = filialService.findById(map.getLong("filial.idFilial"));
    	turno.setFilial(filial);
    	turno.setDsTurno(map.getString("dsTurno"));
    	turno.setDtVigenciaFinal(map.getYearMonthDay("dtVigenciaFinal"));
    	turno.setDtVigenciaInicial(map.getYearMonthDay("dtVigenciaInicial"));
    	turno.setHrTurnoFinal(map.getTimeOfDay("hrTurnoFinal"));
    	turno.setHrTurnoInicial(map.getTimeOfDay("hrTurnoInicial"));
    	
    	
    	TypedFlatMap retorno = new TypedFlatMap();
    	Long id = (Long)turnoService.store(turno);
    	
    	retorno.put("idTurno",id);
    	retorno.put("acaoVigenciaAtual",JTVigenciaUtils.getIntegerAcaoVigencia(turno));
        
        return retorno;
    }
    
    public TypedFlatMap findByIdDetalhamento(TypedFlatMap mapa) {
    	
    	Turno turno = findById(mapa.getLong("idTurno"));
    	mapa.put("dsTurno", turno.getDsTurno());
    	mapa.put("dtVigenciaFinal", turno.getDtVigenciaFinal());
    	mapa.put("dtVigenciaInicial", turno.getDtVigenciaInicial());
    	mapa.put("hrTurnoFinal", turno.getHrTurnoFinal());
    	mapa.put("hrTurnoInicial", turno.getHrTurnoInicial());
		mapa.put("idTurno",turno.getIdTurno());
    	
		mapa.put("filial.idFilial",turno.getFilial().getIdFilial());		
		mapa.put("filial.sgFilial",turno.getFilial().getSgFilial());		
		mapa.put("pessoa.nmFantasia",turno.getFilial().getPessoa().getNmFantasia());	
		
    	mapa.put("acaoVigenciaAtual",JTVigenciaUtils.getIntegerAcaoVigencia(turno));

    	return mapa;
    }
    
	public void setService(TurnoService turnoService) {
		this.defaultService = turnoService;
	}
	
	/**
	 * Ádamo B. Azambuja
	 * Este método retorna filias da empresa Mercurio apenas.
	 * */
	public List findLookupFilial(Map criteria) {
		return filialService.findLookupFilial(criteria);
	}
	
    public void removeById(java.lang.Long id) {
        ((TurnoService)defaultService).removeById(id);
    }

	/**
	 * 
	 */
	@ParametrizedAttribute(type = java.lang.Long.class)
    public void removeByIds(List ids) {
    	((TurnoService)defaultService).removeByIds(ids);
    }

    public Turno findById(java.lang.Long id) {
    	return ((TurnoService)defaultService).findById(id);
    }

    public FilialService getFilialService() {
		return filialService;
	}

	public void setFilialService(FilialService filialService) {
		this.filialService = filialService;
	}
	public void setTurnoService(TurnoService turnoService) {
		this.turnoService = turnoService;
	}

	public ResultSetPage findPaginated(Map criteria) {
		// TODO Auto-generated method stub
		return turnoService.findPaginated(criteria);
	}
}
