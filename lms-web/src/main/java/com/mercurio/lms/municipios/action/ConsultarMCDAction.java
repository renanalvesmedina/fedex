package com.mercurio.lms.municipios.action;

import java.util.List;
import java.util.Map;

import com.mercurio.adsm.framework.model.FindDefinition;
import com.mercurio.adsm.framework.model.ResultSetPage;
import com.mercurio.adsm.framework.util.TypedFlatMap;
import com.mercurio.lms.configuracoes.model.service.ServicoService;
import com.mercurio.lms.municipios.model.Regional;
import com.mercurio.lms.municipios.model.param.MCDParam;
import com.mercurio.lms.municipios.model.service.ConsultarMCDService;
import com.mercurio.lms.municipios.model.service.FilialService;
import com.mercurio.lms.municipios.model.service.MunicipioFilialService;
import com.mercurio.lms.municipios.model.service.RegionalService;
import com.mercurio.lms.util.JTDateTimeUtils;

/**
 * Generated by: ADSM ActionGenerator
 *  
 * Não inserir documentação após ou remover a tag do XDoclet a seguir.
 * O valor do <code>id</code> informado abaixo deve ser utilizado para referenciar este serviço.
 * @spring.bean id="lms.municipios.consultarMCDAction"
 */
public class ConsultarMCDAction {
	
	private ConsultarMCDService consultarMCDService;

	public void setService(ConsultarMCDService defaultService) {
		this.consultarMCDService = defaultService;
	}
	
	private ConsultarMCDService getConsultarMCDService() {
		return consultarMCDService;
	}

	private FilialService filialService;
	private ServicoService servicoService;
	private MunicipioFilialService municipioFilialService;
	private RegionalService regionalService;
	private List<Regional> regionais;
	
	public List<Regional> findRegionaisValidas() {
		if (regionais == null) {
			regionais = regionalService.findRegionaisValidas();
		}
		return regionais;
	}
	
	public void setRegionalService(RegionalService regionalFilialService) {
		this.regionalService = regionalFilialService;
	}
	
	/**
	 * Find Paginated da tela de consulta de MCD.
	 * @param criteria
	 * @return
	 */
	public ResultSetPage findPaginatedCustom(TypedFlatMap criteria) {
		FindDefinition fDef = FindDefinition.createFindDefinition(criteria);
		return getConsultarMCDService().findPaginatedCustom(configureMCDParam(criteria),fDef.getCurrentPage(),fDef.getPageSize());
    }
	
	/**
	 * Retorna número de registros da consulta de MCD.
	 * @param criteria
	 * @return
	 */
    public Integer getRowCountCustom(TypedFlatMap criteria) {
    	return getConsultarMCDService().getRowCountCustom(configureMCDParam(criteria));
    }
    
    private MCDParam configureMCDParam(TypedFlatMap values) {
    	MCDParam dados = new MCDParam();
		dados.setIdMunicipioOrigem(values.getLong("municipioFilialByIdMunicipioFilialOrigem.municipio.idMunicipio"));
		dados.setIdFilialOrigem(values.getLong("municipioFilialByIdMunicipioFilialOrigem.filial.idFilial"));
		dados.setIdUnidadeFederativaOrigem(
				values.getLong("municipioFilialByIdMunicipioFilialOrigem.municipio.unidadeFederativa.idUnidadeFederativa"));

		dados.setIdFilialDestino(values.getLong("municipioFilialByIdMunicipioFilialDestino.filial.idFilial"));
		dados.setIdMunicipioDestino(values.getLong("municipioFilialByIdMunicipioFilialDestino.municipio.idMunicipio"));
		dados.setIdUnidadeFederativaDestino(
				values.getLong("municipioFilialByIdMunicipioFilialDestino.municipio.unidadeFederativa.idUnidadeFederativa"));
		
		dados.setIdServico(values.getLong("servico.idServico"));
		dados.setTpEmissao(values.getString("tpEmissao"));
		dados.setDtVigencia(JTDateTimeUtils.getDataAtual());
		
		dados.setIdRegionalOrigem(values.getLong("idRegionalOrigem"));
		dados.setIdRegionalDestino(values.getLong("idRegionalDestino"));
		
		return dados;
    }
    

	public List findLookupFilial(Map criteria) {
		return filialService.findLookup(criteria);
	}
	
	public List findComboServico(TypedFlatMap criteria) {
		return servicoService.find(criteria);
	}
	
	public List findLookupMunicipio(Map criteria) {
		return municipioFilialService.findLookup(criteria);
	}
	
	
	public FilialService getFilialService() {
		return filialService;
	}

	public void setFilialService(FilialService filialService) {
		this.filialService = filialService;
	}

	public ServicoService getServicoService() {
		return servicoService;
	}

	public void setServicoService(ServicoService servicoService) {
		this.servicoService = servicoService;
	}
	public MunicipioFilialService getMunicipioFilialService() {
		return municipioFilialService;
	}
	public void setMunicipioFilialService(
			MunicipioFilialService municipioFilialService) {
		this.municipioFilialService = municipioFilialService;
	}
	
}
