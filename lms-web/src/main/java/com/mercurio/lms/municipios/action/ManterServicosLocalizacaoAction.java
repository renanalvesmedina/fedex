package com.mercurio.lms.municipios.action;

import java.util.HashMap;
import java.util.List;
import java.util.Map;

import com.mercurio.adsm.framework.model.CrudAction;
import com.mercurio.adsm.framework.model.ResultSetPage;
import com.mercurio.adsm.framework.util.TypedFlatMap;
import com.mercurio.lms.configuracoes.model.Servico;
import com.mercurio.lms.configuracoes.model.service.ServicoService;
import com.mercurio.lms.municipios.model.Filial;
import com.mercurio.lms.municipios.model.MunicipioFilial;
import com.mercurio.lms.municipios.model.OperacaoServicoLocaliza;
import com.mercurio.lms.municipios.model.TipoLocalizacaoMunicipio;
import com.mercurio.lms.municipios.model.service.EmpresaService;
import com.mercurio.lms.municipios.model.service.FilialService;
import com.mercurio.lms.municipios.model.service.MunicipioFilialService;
import com.mercurio.lms.municipios.model.service.MunicipioService;
import com.mercurio.lms.municipios.model.service.OperacaoServicoLocalizaService;
import com.mercurio.lms.municipios.model.service.PaisService;
import com.mercurio.lms.municipios.model.service.TipoLocalizacaoMunicipioService;
import com.mercurio.lms.municipios.model.service.UnidadeFederativaService;
import com.mercurio.lms.util.JTVigenciaUtils;
import com.mercurio.lms.util.TimeUtils;

import com.mercurio.adsm.framework.annotations.ParametrizedAttribute;

/**
 * Generated by: ADSM ActionGenerator
 *  
 * Não inserir documentação após ou remover a tag do XDoclet a seguir.
 * O valor do <code>id</code> informado abaixo deve ser utilizado para referenciar este serviço.
 * @spring.bean id="lms.municipios.manterServicosLocalizacaoAction"
 */

public class ManterServicosLocalizacaoAction extends CrudAction {
	private MunicipioFilialService municipioFilialService;
	private UnidadeFederativaService unidadeFederativaService;
	private FilialService filialService;
	private PaisService paisService;
	private MunicipioService municipioService;
	private ServicoService servicoService;
	private TipoLocalizacaoMunicipioService tipoLocalizacaoMunicipioService;
	private EmpresaService empresaService;

	public List findLookupEmpresa(Map criteria) {
    	return empresaService.findLookup(criteria);
    }

	/**
	 *
	 */
	@ParametrizedAttribute(type = java.lang.Long.class)
	public void removeByIds(List ids) {
		getOperacaoServicoLocalizaService().removeByIds(ids);
	}

	public void removeById(java.lang.Long id) {
		getOperacaoServicoLocalizaService().removeById(id);
	}

	public Map findByIdDetalhado(java.lang.Long id) {
		return getOperacaoServicoLocalizaService().findByIdDetalhado(id);
	}

	public Map storeCustom(TypedFlatMap map) {
		OperacaoServicoLocaliza operacaoServicoLocalizacao = new OperacaoServicoLocaliza();

		operacaoServicoLocalizacao.setIdOperacaoServicoLocaliza(map.getLong("idOperacaoServicoLocaliza")); 
		operacaoServicoLocalizacao.setBlAceitaFreteFob(map.getBoolean("blAceitaFreteFob"));
		operacaoServicoLocalizacao.setBlAtendimentoGeral(map.getBoolean("blAtendimentoGeral"));
		operacaoServicoLocalizacao.setBlCobraTaxaFluvial(map.getBoolean("blCobraTaxaFluvial"));
		operacaoServicoLocalizacao.setBlDomingo(map.getBoolean("blDomingo"));
		operacaoServicoLocalizacao.setBlQuarta(map.getBoolean("blQuarta"));
		operacaoServicoLocalizacao.setBlQuinta(map.getBoolean("blQuinta"));
		operacaoServicoLocalizacao.setBlSabado(map.getBoolean("blSabado")); 
		operacaoServicoLocalizacao.setBlSegunda(map.getBoolean("blSegunda"));
		operacaoServicoLocalizacao.setBlSexta(map.getBoolean("blSexta"));
		operacaoServicoLocalizacao.setBlTerca(map.getBoolean("blTerca"));
		operacaoServicoLocalizacao.setDtVigenciaInicial(map.getYearMonthDay("dtVigenciaInicial"));
		operacaoServicoLocalizacao.setDtVigenciaFinal(map.getYearMonthDay("dtVigenciaFinal"));

		operacaoServicoLocalizacao.setNrTempoColeta(map.getLong("nrTempoColeta"));
		operacaoServicoLocalizacao.setNrTempoEntrega(map.getLong("nrTempoEntrega"));
		operacaoServicoLocalizacao.setTpOperacao(map.getDomainValue("tpOperacao"));

		if (map.getLong("servico.idServico") != null) {
			Servico servico = new Servico();
			servico.setIdServico(map.getLong("servico.idServico"));
			operacaoServicoLocalizacao.setServico(servico);
		}

		TipoLocalizacaoMunicipio tipoLocalizacaoMunicipio = new TipoLocalizacaoMunicipio();
		tipoLocalizacaoMunicipio.setIdTipoLocalizacaoMunicipio(map.getLong("tipoLocalizacaoMunicipio.idTipoLocalizacaoMunicipio"));
		operacaoServicoLocalizacao.setTipoLocalizacaoMunicipio(tipoLocalizacaoMunicipio);
		
		TipoLocalizacaoMunicipio tipoLocalizacaoMunicipioFob = new TipoLocalizacaoMunicipio();
		tipoLocalizacaoMunicipioFob.setIdTipoLocalizacaoMunicipio(map.getLong("tipoLocalizacaoMunicipioFob.idTipoLocalizacaoMunicipio"));
		operacaoServicoLocalizacao.setTipoLocalizacaoMunicipioFob(tipoLocalizacaoMunicipioFob);

		MunicipioFilial municipioFilial = new MunicipioFilial();
		municipioFilial.setIdMunicipioFilial(map.getLong("municipioFilial.idMunicipioFilial"));

		Filial filial = new Filial();
		filial.setIdFilial(map.getLong("municipioFilial.filial.idFilial"));
		municipioFilial.setFilial(filial);

		operacaoServicoLocalizacao.setMunicipioFilial(municipioFilial);

		getOperacaoServicoLocalizaService().store(operacaoServicoLocalizacao);

		map.put("idOperacaoServicoLocaliza", operacaoServicoLocalizacao.getIdOperacaoServicoLocaliza());
		map.put("nrTempoColeta", operacaoServicoLocalizacao.getNrTempoColeta());
		map.put("nrTempoEntrega", operacaoServicoLocalizacao.getNrTempoEntrega());

		// relendo os tempos salvos em minutos para horas
		Integer nrTempoColeta = null;
		if (map.get("nrTempoColeta") != null && !map.get("nrTempoColeta").toString().equals(""))
			nrTempoColeta = Integer.valueOf(((Long)map.remove("nrTempoColeta")).intValue());

		Integer nrTempoEntrega = null;
		if (map.get("nrTempoEntrega") != null && !map.get("nrTempoEntrega").toString().equals(""))
			nrTempoEntrega = Integer.valueOf(((Long)map.remove("nrTempoEntrega")).intValue());		

		map.put("nrTempoEntrega", TimeUtils.minutesToHoursInteger(nrTempoEntrega));
		map.put("nrTempoColeta", TimeUtils.minutesToHoursInteger(nrTempoColeta));
		map.put("acaoVigenciaAtual", JTVigenciaUtils.getIntegerAcaoVigencia(operacaoServicoLocalizacao));

		return map;
	}

	//*************************GRID***************************************//
	public ResultSetPage findPaginatedCustom(TypedFlatMap criteria) {
		return getOperacaoServicoLocalizaService().findPaginatedCustom(criteria);
	}

	public Integer getRowCountCustom(TypedFlatMap criteria) {
		return getOperacaoServicoLocalizaService().getRowCountCustom(criteria);
	}

	//************************LOOKUP***********************************//
	public List findLookupMunicipioFilial(TypedFlatMap criteria) {
		return municipioFilialService.findLookupAsPaginated(criteria);
	}

	public List findLookupUnidadeFederativa(Map criteria) {
		return unidadeFederativaService.findLookup(criteria);
	}

	public List findLookupFilial(Map criteria) {
		return filialService.findLookup(criteria);
	}

	public List findLookupPais(Map criteria) {
		return paisService.findLookup(criteria);
	}

	public List findLookupMunicipio(Map criteria) {
		return municipioService.findLookup(criteria);
	}

	//************************COMBO******************************************//
	public List findServico(Map criteria) {
		return servicoService.find(criteria);
	}

	public List findTipoLocalizacaoMunicipio(Map criteria) {
		if (criteria == null) {
			criteria = new HashMap<String, Object>();
		}
		criteria.put("tpLocalizacao", "O");
		return tipoLocalizacaoMunicipioService.find(criteria);
	}
	
	public List findTipoLocalizacaoMunicipioFob(Map criteria) {
		if (criteria == null) {
			criteria = new HashMap<String, Object>();
		}
		criteria.put("tpLocalizacao", "C");
		return tipoLocalizacaoMunicipioService.find(criteria);
	}

	public void setOperacaoServicoLocalizaService(OperacaoServicoLocalizaService operacaoServicoLocalizaService) {
		this.defaultService = operacaoServicoLocalizaService;
	}
	private OperacaoServicoLocalizaService getOperacaoServicoLocalizaService() {
		return (OperacaoServicoLocalizaService)this.defaultService;
	}
	public void setEmpresaService(EmpresaService empresaService) {
		this.empresaService = empresaService;
	}
	public void setFilialService(FilialService filialService) {
		this.filialService = filialService;
	}
	public void setMunicipioFilialService(MunicipioFilialService municipioFilialService) {
		this.municipioFilialService = municipioFilialService;
	}
	public void setPaisService(PaisService paisService) {
		this.paisService = paisService;
	}
	public void setUnidadeFederativaService(UnidadeFederativaService unidadeFederativaService) {
		this.unidadeFederativaService = unidadeFederativaService;
	}
	public void setMunicipioService(MunicipioService municipioService) {
		this.municipioService = municipioService;
	}
	public void setServicoService(ServicoService servicoService) {
		this.servicoService = servicoService;
	}
	public void setTipoLocalizacaoMunicipioService(TipoLocalizacaoMunicipioService tipoLocalizacaoMunicipioService) {
		this.tipoLocalizacaoMunicipioService = tipoLocalizacaoMunicipioService;
	}

}
