package com.mercurio.lms.vendas.action;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import com.mercurio.adsm.framework.model.CrudAction;
import com.mercurio.adsm.framework.model.DomainValue;
import com.mercurio.adsm.framework.util.TypedFlatMap;
import com.mercurio.lms.util.FormatUtils;
import com.mercurio.lms.vendas.model.ClienteDespachante;
import com.mercurio.lms.vendas.model.service.ClienteDespachanteService;
import com.mercurio.lms.vendas.model.service.DespachanteService;

import com.mercurio.adsm.framework.annotations.ParametrizedAttribute;

/**
 * Generated by: ADSM ActionGenerator
 *  
 * Não inserir documentação após ou remover a tag do XDoclet a seguir.
 * O valor do <code>id</code> informado abaixo deve ser utilizado para referenciar este serviço.
 * @spring.bean id="lms.vendas.manterDespachantesClienteAction"
 */

public class ManterDespachantesClienteAction extends CrudAction {
	
	private DespachanteService despachanteService;
	
	public void setClienteDespachante(ClienteDespachanteService clienteDespachanteService) {
		this.defaultService = clienteDespachanteService;
	}
    public void removeById(java.lang.Long id) {
        ((ClienteDespachanteService)defaultService).removeById(id);
    }

	/**
	 *
	 */
	@ParametrizedAttribute(type = java.lang.Long.class)
    public void removeByIds(List ids) {
    	((ClienteDespachanteService)defaultService).removeByIds(ids);
    }

    public ClienteDespachante findById(java.lang.Long id) {
    	return ((ClienteDespachanteService)defaultService).findById(id);
    }
    
    public List findLookupDespachantes(TypedFlatMap tfm){
    	
    	List retorno = despachanteService.findLookupWithPhone(tfm);
    	
    	List mapeada = new ArrayList();
    	
    	for (Iterator iter = retorno.iterator(); iter.hasNext();) {
			
    		Map element = (Map) iter.next();
    		tfm = new TypedFlatMap();
    		
    		tfm.put("idDespachante",element.get("idDespachante"));
    		tfm.put("pessoa.idPessoa",element.get("idPessoa"));
    		tfm.put("pessoa.nrIdentificacao",element.get("nrIdentificacao"));
    		tfm.put("pessoa.tpPessoa",element.get("tpPessoa"));
    		tfm.put("pessoa.nmPessoa",element.get("nmPessoa"));
    		
			tfm.put("pessoa.nrIdentificacaoFormatado",FormatUtils.formatIdentificacao((DomainValue)element.get("tpIdentificacao"),
																					  (String)element.get("nrIdentificacao")));
			
			mapeada.add(tfm);
			
		}
    	
    	return mapeada; 
    }
	public void setDespachanteService(DespachanteService despachanteService) {
		this.despachanteService = despachanteService;
	}

}
