package com.mercurio.lms.portaria.action;

import java.util.List;
import java.util.Map;

import org.joda.time.YearMonthDay;

import com.mercurio.adsm.framework.model.CrudAction;
import com.mercurio.adsm.framework.model.ResultSetPage;
import com.mercurio.adsm.framework.util.TypedFlatMap;
import com.mercurio.lms.contratacaoveiculos.model.MeioTransporteRodoviario;
import com.mercurio.lms.contratacaoveiculos.model.service.MeioTransporteRodoviarioService;
import com.mercurio.lms.municipios.model.Filial;
import com.mercurio.lms.municipios.model.Rota;
import com.mercurio.lms.municipios.model.RotaColetaEntrega;
import com.mercurio.lms.municipios.model.RotaIdaVolta;
import com.mercurio.lms.municipios.model.service.FilialService;
import com.mercurio.lms.municipios.model.service.RotaColetaEntregaService;
import com.mercurio.lms.municipios.model.service.RotaIdaVoltaService;
import com.mercurio.lms.portaria.model.ConfiguracaoAuditoriaFil;
import com.mercurio.lms.portaria.model.service.ConfiguracaoAuditoriaFilService;
import com.mercurio.lms.util.JTVigenciaUtils;
import com.mercurio.lms.util.session.SessionUtils;

import com.mercurio.adsm.framework.annotations.ParametrizedAttribute;

 
 
/**
 * Generated by: ADSM ActionGenerator
 *  
 * Não inserir documentação após ou remover a tag do XDoclet a seguir.
 * O valor do <code>id</code> informado abaixo deve ser utilizado para referenciar este serviço.
 * @spring.bean id="lms.portaria.manterAuditoriasEspecificasAction"
 */

public class ManterAuditoriasEspecificasAction extends CrudAction {
	
	private FilialService filialService;
	private RotaIdaVoltaService rotaIdaVoltaService;
	private RotaColetaEntregaService rotaColetaEntregaService;
	private MeioTransporteRodoviarioService meioTransporteRodoViarioService;
	
	
	
    /****************************************************************************************
     * Métodos store
     ****************************************************************************************/

	public TypedFlatMap store(TypedFlatMap tfm) {
					
	    Filial filial = new Filial();
	    filial.setIdFilial(tfm.getLong("filial.idFilial"));
	    filial.setSgFilial(tfm.getString("filial.sgFilial"));
	    
	    ConfiguracaoAuditoriaFil configuracaoAuditoriaFil = new ConfiguracaoAuditoriaFil();
	    configuracaoAuditoriaFil.setIdConfiguracaoAuditoriaFil(tfm.getLong("idConfiguracaoAuditoriaFil"));
	    configuracaoAuditoriaFil.setFilial(filial);
	    
	    configuracaoAuditoriaFil.setDtVigenciaInicial(tfm.getYearMonthDay("dtVigenciaInicial"));
	    configuracaoAuditoriaFil.setDtVigenciaFinal(tfm.getYearMonthDay("dtVigenciaFinal"));
	    configuracaoAuditoriaFil.setHrAuditoriaInicial(tfm.getTimeOfDay("hrAuditoriaInicial"));
	    configuracaoAuditoriaFil.setHrAuditoriaFinal(tfm.getTimeOfDay("hrAuditoriaFinal"));
	    configuracaoAuditoriaFil.setTpOperacao(tfm.getDomainValue("tpOperacao"));
	    
	    if (tfm.getLong("meioTransporteRodoviario.idMeioTransporte") != null) {
		    MeioTransporteRodoviario mtr = new MeioTransporteRodoviario();
		    mtr.setIdMeioTransporte(tfm.getLong("meioTransporteRodoviario.idMeioTransporte"));
		    configuracaoAuditoriaFil.setMeioTransporteRodoviario(mtr);
	    }
	    
	    if (tfm.getLong("rotaColetaEntrega.idRotaColetaEntrega") != null) {
		    RotaColetaEntrega rce = new RotaColetaEntrega();
		    rce.setIdRotaColetaEntrega(tfm.getLong("rotaColetaEntrega.idRotaColetaEntrega"));
		    configuracaoAuditoriaFil.setRotaColetaEntrega(rce);
	    }
	    
	    if (tfm.getLong("rotaIdaVolta.idRotaIdaVolta") != null){
		    RotaIdaVolta riv = new RotaIdaVolta();
		    riv.setIdRotaIdaVolta(tfm.getLong("rotaIdaVolta.idRotaIdaVolta"));
		    
		    Rota rota = new Rota();
		    rota.setDsRota(tfm.getString("rotaViagem.dsRota"));
		    riv.setRota(rota);
		    
		    riv.setVersao(tfm.getInteger("rotaIdaVolta.versao"));
		    configuracaoAuditoriaFil.setRotaIdaVolta(riv);
	    }    
	    	        
		getConfiguracaoAuditoriaFilService().store(configuracaoAuditoriaFil);
		
		TypedFlatMap retorno = new TypedFlatMap();
		retorno.put("idConfiguracaoAuditoriaFil", configuracaoAuditoriaFil.getIdConfiguracaoAuditoriaFil());
		retorno.put("acaoVigenciaAtual", JTVigenciaUtils.getIntegerAcaoVigencia(configuracaoAuditoriaFil));
		return retorno;
	}
	

	
    /****************************************************************************************
     * Finders
     ****************************************************************************************/

	public List findLookupFilial(TypedFlatMap tfm) {
		return getFilialService().findLookupFilial(tfm);
	}
	
	public List findLookupMeioTransporteRodoviario(Map tfm) {
		TypedFlatMap t = new TypedFlatMap();
		Map p = (Map)tfm.get("meioTransporte");
		t.put("meioTransporte.nrFrota", 		p.get("nrFrota"));
		t.put("meioTransporte.nrIdentificador", p.get("nrIdentificador"));
		return getMeioTransporteRodoViarioService().findLookup(t);
	}
	
    public Filial findFilialUsuarioLogado() {
    	return SessionUtils.getFilialSessao();
    }
	
	public List findLookupRotasViagem(TypedFlatMap tfm) {
		return rotaIdaVoltaService.findLookupRotaIdaVolta(tfm);
	}
	public List findComboRotaColetaEntrega(TypedFlatMap tfm) {
		Long idFilial = tfm.getLong("filial.idFilial");
		if (idFilial != null)
			return getRotaColetaEntregaService().findRotaColetaEntregaByIdFilial(idFilial, false);
		return null;
	}
	
    public ConfiguracaoAuditoriaFil findById(java.lang.Long id) {
    	return getConfiguracaoAuditoriaFilService().findById(id);
    }
    
    public Map findByIdMap(java.lang.Long id) {
    	ConfiguracaoAuditoriaFil caf = ((ConfiguracaoAuditoriaFilService)defaultService).findById(id);
    	
    	TypedFlatMap lista = new TypedFlatMap();

    	lista.put("filial.idFilial",caf.getFilial().getIdFilial());
    	lista.put("pessoa.nmFantasia",caf.getFilial().getPessoa().getNmFantasia());
    	
    	lista.put("tpOperacao",caf.getTpOperacao());
    	lista.put("meioTransporteRodoviario2.idMeioTransporte",caf.getMeioTransporteRodoviario().getIdMeioTransporte());
    	lista.put("meioTransporteRodoviario.idMeioTransporte",caf.getMeioTransporteRodoviario().getIdMeioTransporte());
    	lista.put("rotaIdaVolta.idRotaIdaVolta",caf.getRotaIdaVolta().getIdRotaIdaVolta());
    	lista.put("rotaColetaEntrega.idRotaColetaEntrega",caf.getRotaColetaEntrega().getIdRotaColetaEntrega());
    	lista.put("hrAuditoriaInicial",caf.getHrAuditoriaInicial());
    	lista.put("hrAuditoriaFinal",caf.getHrAuditoriaFinal());
    	lista.put("dtVigenciaInicial",caf.getDtVigenciaInicial());
    	lista.put("dtVigenciaFinal",caf.getDtVigenciaFinal());

    	lista.put("acaoVigenciaAtual",JTVigenciaUtils.getIntegerAcaoVigencia(caf));
    	
    	
    	return lista;
    }
	
    public Integer getRowCountCustom(TypedFlatMap tfm) {
    	return getConfiguracaoAuditoriaFilService().getRowCountCustom(tfm);
    }
    
    public ResultSetPage findPaginated(TypedFlatMap criteria) {
    	return getConfiguracaoAuditoriaFilService().findPaginatedCustom(criteria);
    }
    
    public TypedFlatMap findByIdCustom(TypedFlatMap criteria) {
    	TypedFlatMap map = getConfiguracaoAuditoriaFilService().findByIdCustom(criteria);
    	YearMonthDay dtVigenciaInicial = (YearMonthDay)map.get("dtVigenciaInicial");
    	YearMonthDay dtVigenciaFinal = (YearMonthDay)map.get("dtVigenciaFinal");
    	map.put("acaoVigenciaAtual",JTVigenciaUtils.getIntegerAcaoVigencia(dtVigenciaInicial, dtVigenciaFinal));
    	return map;
    }
	
    /****************************************************************************************
     * Métodos de remove
     ****************************************************************************************/
	
    public void removeById(java.lang.Long id) {
        getConfiguracaoAuditoriaFilService().removeById(id);
    }

	/**
	 *
	 */
	@ParametrizedAttribute(type = java.lang.Long.class)
    public void removeByIds(List ids) {
    	getConfiguracaoAuditoriaFilService().removeByIds(ids);
    }
    
    /****************************************************************************************
     * Getters e Setters
     ****************************************************************************************/

	public void setConfiguracaoAuditoriaFilService(ConfiguracaoAuditoriaFilService serviceService) {
		this.defaultService = serviceService;
	}
	
	public ConfiguracaoAuditoriaFilService getConfiguracaoAuditoriaFilService() {
		return (ConfiguracaoAuditoriaFilService)this.defaultService;
	}

	public FilialService getFilialService() {
		return filialService;
	}

	public void setFilialService(FilialService filialService) {
		this.filialService = filialService;
	}

	public MeioTransporteRodoviarioService getMeioTransporteRodoViarioService() {
		return meioTransporteRodoViarioService;
	}

	public void setMeioTransporteRodoViarioService(MeioTransporteRodoviarioService meioTransporteRodoViarioService) {
		this.meioTransporteRodoViarioService = meioTransporteRodoViarioService;
	}

	public RotaColetaEntregaService getRotaColetaEntregaService() {
		return rotaColetaEntregaService;
	}

	public void setRotaColetaEntregaService(RotaColetaEntregaService rotaColetaEntregaService) {
		this.rotaColetaEntregaService = rotaColetaEntregaService;
	}



	/**
	 * @param rotaIdaVoltaService The rotaIdaVoltaService to set.
	 */
	public void setRotaIdaVoltaService(RotaIdaVoltaService rotaIdaVoltaService) {
		this.rotaIdaVoltaService = rotaIdaVoltaService;
	}


}
