package com.mercurio.lms.seguros.action;

import java.io.Serializable;
import java.util.List;
import java.util.Map;

import com.mercurio.adsm.framework.annotations.ParametrizedAttribute;
import com.mercurio.adsm.framework.model.CrudAction;
import com.mercurio.adsm.framework.util.TypedFlatMap;
import com.mercurio.lms.seguros.model.DoctoProcessoSinistro;
import com.mercurio.lms.seguros.model.ProcessoSinistro;
import com.mercurio.lms.seguros.model.TipoDocumentoSeguro;
import com.mercurio.lms.seguros.model.service.DoctoProcessoSinistroService;
import com.mercurio.lms.seguros.model.service.ProcessoSinistroService;
import com.mercurio.lms.seguros.model.service.TipoDocumentoSeguroService;
import com.mercurio.lms.util.JTDateTimeUtils;

/**
 * Generated by: ADSM ActionGenerator
 *  
 * Não inserir documentação após ou remover a tag do XDoclet a seguir.
 * O valor do <code>id</code> informado abaixo deve ser utilizado para referenciar este serviço.
 * @spring.bean id="lms.seguros.action.registrarRecebimentosEntregaDocumentoAction"
 */
public class RegistrarRecebimentosEntregaDocumentoAction extends CrudAction {

	TipoDocumentoSeguroService tipoDocumentoSeguroService;
	ProcessoSinistroService processoSinistroService;
	
	public Serializable storeCustom(TypedFlatMap tfm) {
		Long idDoctoProcessoSinistro = tfm.getLong("idDoctoProcessoSinistro");
		Long idProcessoSinistro = tfm.getLong("processoSinistro.idProcessoSinistro");
		Long idTipoDocumentoSeguro = tfm.getLong("tipoDocumentoSeguro.idTipoDocumentoSeguro");
		
		DoctoProcessoSinistro doctoProcessoSinistro = new DoctoProcessoSinistro();
		doctoProcessoSinistro.setIdDoctoProcessoSinistro(idDoctoProcessoSinistro);
		ProcessoSinistro processoSinistro = getProcessoSinistroService().findById(idProcessoSinistro);
		TipoDocumentoSeguro tipoDocumentoSeguro = tipoDocumentoSeguroService.findById(idTipoDocumentoSeguro);
		
		doctoProcessoSinistro.setProcessoSinistro(processoSinistro);
		doctoProcessoSinistro.setTpEntregaRecebimento(tfm.getDomainValue("tpEntregaRecebimento"));
		
		// setando a hora atual na data de cadastro
		doctoProcessoSinistro.setDhCadastroDocumento(tfm.getDateTime("dhCadastroDocumento"));
		doctoProcessoSinistro.setTipoDocumentoSeguro(tipoDocumentoSeguro);
		doctoProcessoSinistro.setNrDocumento(tfm.getString("nrDocumento"));
		doctoProcessoSinistro.setNmRecebedor(tfm.getString("nmRecebedor"));
		doctoProcessoSinistro.setNrProtocolo(tfm.getLong("nrProtocolo"));
		doctoProcessoSinistro.setObDocumentoProcesso(tfm.getString("obDocumentoProcesso"));
		
		getProcessoSinistroService().store(processoSinistro);
		return getDoctoProcessoSinistroService().store(doctoProcessoSinistro);
	}
	
	public TypedFlatMap getDate() {
		TypedFlatMap retorno = new TypedFlatMap();
		retorno.put("dtConsulta", JTDateTimeUtils.getDataHoraAtual());
		return retorno;
	}
	
	public List findComboTiposDocumentoSeguro(Map criteria) {
		return this.tipoDocumentoSeguroService.find(criteria);
	}
	
    public void removeById(java.lang.Long id) {
        ((DoctoProcessoSinistroService)defaultService).removeById(id);
    }
	/**
	 *
	 */
	@ParametrizedAttribute(type = java.lang.Long.class)
    public void removeByIds(List ids) {
    	((DoctoProcessoSinistroService)defaultService).removeByIds(ids);
    }
    
    public TypedFlatMap findByIdCustom(java.lang.Long id) {

    	DoctoProcessoSinistro dps = ((DoctoProcessoSinistroService)defaultService).findById(id); 
    	TypedFlatMap result = new TypedFlatMap();
    	
    	result.put("idDoctoProcessoSinistro", dps.getIdDoctoProcessoSinistro());
    	result.put("tpEntregaRecebimento.description", dps.getTpEntregaRecebimento().getDescription());
    	result.put("tpEntregaRecebimento.value", dps.getTpEntregaRecebimento().getValue());
    	
    	// retornando um date para a tela
    	result.put("dhCadastroDocumento", dps.getDhCadastroDocumento());
    	result.put("tipoDocumentoSeguro.idTipoDocumentoSeguro", dps.getTipoDocumentoSeguro().getIdTipoDocumentoSeguro());
    	result.put("tipoDocumentoSeguro.dsTipo", dps.getTipoDocumentoSeguro().getDsTipo());
    	result.put("nrDocumento",dps.getNrDocumento());
    	result.put("nmRecebedor",dps.getNmRecebedor());
    	result.put("nrProtocolo",dps.getNrProtocolo());
    	result.put("obDocumentoProcesso",dps.getObDocumentoProcesso());
    	return result;
    }

    // ######################################################################################
    // getters and setters
    // ######################################################################################
	public void setDefaultService(DoctoProcessoSinistroService doctoProcessoSinistroService) {
		this.defaultService = doctoProcessoSinistroService;
	}
	public DoctoProcessoSinistroService getDoctoProcessoSinistroService() {
		return (DoctoProcessoSinistroService)this.defaultService;
	}
    public void setTipoDocumentoSeguroService(TipoDocumentoSeguroService tipoDocumentoSeguroService) {
		this.tipoDocumentoSeguroService = tipoDocumentoSeguroService;
	}

	public ProcessoSinistroService getProcessoSinistroService() {
		return processoSinistroService;
	}

	public void setProcessoSinistroService(
			ProcessoSinistroService processoSinistroService) {
		this.processoSinistroService = processoSinistroService;
	}

}
